<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Simulateur de crédit Paositra Finances</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f8f9fa;
    font-size: 14px;
    color: #333;
  }

  .container {
    width: 50%;
    margin: 0 auto;
  }

  .header {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    text-align: center;
  }
  .logo { height: 60px; max-width: 50%; }
  .title { font-size: 1.8rem; color: #2c3e50; margin: 0; }
  @media (max-width: 600px) {
    .title { font-size: 1.4rem; }
    .logo { height: 50px; }
  }

  .form-container {
    background: #fff;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  label { font-weight: bold; margin-top: 8px; display: block; }
  select, input, button {
    padding: 8px;
    margin-top: 5px;
    border-radius: 8px;
    border: 1px solid #ccc;
    width: 100%;
    font-size: 14px;
    box-sizing: border-box;
  }
  button {
    background: #3498db;
    color: #fff;
    cursor: pointer;
    font-weight: bold;
    margin-top: 15px;
    border: none;
  }
  button:hover { background: #2980b9; }

  .result-box {
    background: #fff;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background: #fff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    table-layout: fixed;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 6px;
    text-align: right;
    font-size: 12px;
    overflow: hidden;
  }
  th { background: #2c3e50; color: white; text-align: center; }
  td:first-child, th:first-child { width: 10%; }
  td:nth-child(2), th:nth-child(2) { width: 25%; }
  td:nth-child(3), th:nth-child(3) { width: 20%; }
  td:nth-child(4), th:nth-child(4) { width: 20%; }
  td:nth-child(5), th:nth-child(5) { width: 25%; }
  tr:nth-child(even) { background: #f2f2f2; }
  tr:hover { background: #eaf2f8; }
  .grace { background: #ffeeba !important; }
  .total-row { font-weight: bold; background: #dff0d8; }
  .summary { font-size: 14px; line-height: 1.6; }
</style>
</head>
<body>
<div class="container">
  <header class="header">
    <img src="logo.png" alt="Paositra Finances" class="logo">
    <h1 class="title">Simulateur de crédit Paositra Finances</h1>
  </header>

  <div class="form-container">
    <label for="produit">Choisir un produit :</label>
    <select id="produit" onchange="updateProduit()">
      <option value="">-- Sélectionnez --</option>
      <option value="KETRIKA">KETRIKA</option>
      <option value="HERIJIKA">HERIJIKA</option>
      <option value="HERIJIKA_PLUS">HERIJIKA PLUS</option>
      <option value="HERIJIKA_PME">HERIJIKA PME</option>
    </select>

    <label for="montant">Montant du prêt (Ariary):</label>
    <input type="number" id="montant">

    <label for="taux">Taux d'intérêt annuel (%):</label>
    <input type="number" id="taux">

    <label for="duree">Durée (mois):</label>
    <input type="number" id="duree">

    <label for="periodeGrace">Période de grâce (mois):</label>
    <input type="number" id="periodeGrace" value="0">

    <button onclick="calculer()">Calculer</button>
  </div>

  <div id="result" class="result-box"></div>
  <div id="resultMensualite" class="result-box"></div>
  <div id="tableauAmortissement"></div>
</div>

<script>
const produits = {
  KETRIKA: { taux: 39, min: 515000, max: 10300000, minDuree: 6, maxDuree: 30 },
  HERIJIKA: { taux: 39, min: 1030000, max: 10300000, minDuree: 6, maxDuree: 24 },
  HERIJIKA_PLUS: { taux: 39, min: 10300001, max: 51500000, minDuree: 6, maxDuree: 24 },
  HERIJIKA_PME: { taux: null, min: 51500001, max: 154500000, minDuree: 6, maxDuree: 24 }
};

function updateProduit() {
  const produit = document.getElementById('produit').value;
  const tauxInput = document.getElementById('taux');
  if (produit && produits[produit].taux !== null) {
    tauxInput.value = produits[produit].taux;
    tauxInput.disabled = true;
  } else {
    tauxInput.value = "";
    tauxInput.disabled = false;
  }
}

// Formater les nombres avec 2 décimales
function formatAriary(val) {
  return val.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " Ar";
}

function calculer() {
  const produit = document.getElementById('produit').value;
  const montant = parseFloat(document.getElementById('montant').value);
  const taux = parseFloat(document.getElementById('taux').value)/100;
  const duree = parseInt(document.getElementById('duree').value);
  const periodeGrace = parseInt(document.getElementById('periodeGrace').value);

  if (!produit || isNaN(montant) || isNaN(taux) || isNaN(duree)) {
    alert("Veuillez remplir tous les champs correctement.");
    return;
  }
  if (periodeGrace >= duree) {
    alert("La période de grâce doit être inférieure à la durée.");
    return;
  }

  const conditions = produits[produit];
  if (montant < conditions.min || montant > conditions.max || duree < conditions.minDuree || duree > conditions.maxDuree) {
    alert(`Conditions non respectées pour ${produit}. Montant: ${formatAriary(conditions.min)} à ${formatAriary(conditions.max)}, Durée: ${conditions.minDuree} à ${conditions.maxDuree} mois.`);
    return;
  }

  const tauxMensuel = taux/12;
  const dureeRestante = duree - periodeGrace;
  const mensualite = montant * tauxMensuel / (1 - Math.pow(1 + tauxMensuel, -dureeRestante));

  let capitalRestant = montant;
  let totalPrincipal = 0, totalInterets = 0, totalMensualites = 0;
  let tableau = `<table>
    <thead><tr>
      <th>Mois</th>
      <th>Capital restant</th>
      <th>Principal</th>
      <th>Intérêt</th>
      <th>Mensualité</th>
    </tr></thead><tbody>`;

  for (let mois = 1; mois <= duree; mois++) {
    let interets, principal, paiement;
    if (mois <= periodeGrace) {
      interets = capitalRestant * tauxMensuel;
      principal = 0;
      paiement = interets;
      tableau += `<tr class="grace"><td>${mois}</td><td>${formatAriary(capitalRestant)}</td><td>${formatAriary(principal)}</td><td>${formatAriary(interets)}</td><td>${formatAriary(paiement)}</td></tr>`;
    } else {
      interets = capitalRestant * tauxMensuel;
      principal = mensualite - interets;
      capitalRestant -= principal;
      paiement = mensualite;
      tableau += `<tr><td>${mois}</td><td>${formatAriary(Math.max(capitalRestant,0))}</td><td>${formatAriary(principal)}</td><td>${formatAriary(interets)}</td><td>${formatAriary(paiement)}</td></tr>`;
    }
    totalPrincipal += principal;
    totalInterets += interets;
    totalMensualites += paiement;
  }

  tableau += `<tr class="total-row"><td>Total</td><td>-</td><td>${formatAriary(totalPrincipal)}</td><td>${formatAriary(totalInterets)}</td><td>${formatAriary(totalMensualites)}</td></tr>`;
  tableau += "</tbody></table>";

  document.getElementById('result').innerHTML =
    `<div class="summary">
      <b>Produit :</b> ${produit}<br>
      <b>Montant emprunté :</b> ${formatAriary(montant)}<br>
      <b>Durée :</b> ${duree} mois (${periodeGrace} mois de grâce)<br>
      <b>Taux annuel :</b> ${(taux*100).toFixed(2)}%<br>
      <b>Total intérêts :</b> ${formatAriary(totalInterets)}<br>
      <b>Coût total du crédit :</b> ${formatAriary(totalMensualites)}
    </div>`;

  document.getElementById('resultMensualite').innerHTML =
    `<b>Mensualité après période de grâce :</b> ${formatAriary(mensualite)}`;

  document.getElementById('tableauAmortissement').innerHTML = tableau;
}
</script>
</body>
</html>
